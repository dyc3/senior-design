<svg aria-roledescription="classDiagram" role="graphics-document document" viewBox="-8 -8 1402.62890625 788" style="max-width: 1402.63px; background-color: white;" xmlns:xlink="http://www.w3.org/1999/xlink" xmlns="http://www.w3.org/2000/svg" width="100%" id="my-svg"><style>#my-svg{font-family:"trebuchet ms",verdana,arial,sans-serif;font-size:16px;fill:#333;}#my-svg .error-icon{fill:#552222;}#my-svg .error-text{fill:#552222;stroke:#552222;}#my-svg .edge-thickness-normal{stroke-width:2px;}#my-svg .edge-thickness-thick{stroke-width:3.5px;}#my-svg .edge-pattern-solid{stroke-dasharray:0;}#my-svg .edge-pattern-dashed{stroke-dasharray:3;}#my-svg .edge-pattern-dotted{stroke-dasharray:2;}#my-svg .marker{fill:#333333;stroke:#333333;}#my-svg .marker.cross{stroke:#333333;}#my-svg svg{font-family:"trebuchet ms",verdana,arial,sans-serif;font-size:16px;}#my-svg g.classGroup text{fill:#9370DB;fill:#131300;stroke:none;font-family:"trebuchet ms",verdana,arial,sans-serif;font-size:10px;}#my-svg g.classGroup text .title{font-weight:bolder;}#my-svg .nodeLabel,#my-svg .edgeLabel{color:#131300;}#my-svg .edgeLabel .label rect{fill:#ECECFF;}#my-svg .label text{fill:#131300;}#my-svg .edgeLabel .label span{background:#ECECFF;}#my-svg .classTitle{font-weight:bolder;}#my-svg .node rect,#my-svg .node circle,#my-svg .node ellipse,#my-svg .node polygon,#my-svg .node path{fill:#ECECFF;stroke:#9370DB;stroke-width:1px;}#my-svg .divider{stroke:#9370DB;stroke-width:1;}#my-svg g.clickable{cursor:pointer;}#my-svg g.classGroup rect{fill:#ECECFF;stroke:#9370DB;}#my-svg g.classGroup line{stroke:#9370DB;stroke-width:1;}#my-svg .classLabel .box{stroke:none;stroke-width:0;fill:#ECECFF;opacity:0.5;}#my-svg .classLabel .label{fill:#9370DB;font-size:10px;}#my-svg .relation{stroke:#333333;stroke-width:1;fill:none;}#my-svg .dashed-line{stroke-dasharray:3;}#my-svg .dotted-line{stroke-dasharray:1 2;}#my-svg #compositionStart,#my-svg .composition{fill:#333333!important;stroke:#333333!important;stroke-width:1;}#my-svg #compositionEnd,#my-svg .composition{fill:#333333!important;stroke:#333333!important;stroke-width:1;}#my-svg #dependencyStart,#my-svg .dependency{fill:#333333!important;stroke:#333333!important;stroke-width:1;}#my-svg #dependencyStart,#my-svg .dependency{fill:#333333!important;stroke:#333333!important;stroke-width:1;}#my-svg #extensionStart,#my-svg .extension{fill:#ECECFF!important;stroke:#333333!important;stroke-width:1;}#my-svg #extensionEnd,#my-svg .extension{fill:#ECECFF!important;stroke:#333333!important;stroke-width:1;}#my-svg #aggregationStart,#my-svg .aggregation{fill:#ECECFF!important;stroke:#333333!important;stroke-width:1;}#my-svg #aggregationEnd,#my-svg .aggregation{fill:#ECECFF!important;stroke:#333333!important;stroke-width:1;}#my-svg #lollipopStart,#my-svg .lollipop{fill:#ECECFF!important;stroke:#333333!important;stroke-width:1;}#my-svg #lollipopEnd,#my-svg .lollipop{fill:#ECECFF!important;stroke:#333333!important;stroke-width:1;}#my-svg .edgeTerminals{font-size:11px;}#my-svg .classTitleText{text-anchor:middle;font-size:18px;fill:#333;}#my-svg :root{--mermaid-font-family:"trebuchet ms",verdana,arial,sans-serif;}</style><g><defs><marker orient="auto" markerHeight="240" markerWidth="190" refY="7" refX="0" class="marker aggregation classDiagram" id="classDiagram-aggregationStart"><path d="M 18,7 L9,13 L1,7 L9,1 Z"/></marker></defs><defs><marker orient="auto" markerHeight="28" markerWidth="20" refY="7" refX="19" class="marker aggregation classDiagram" id="classDiagram-aggregationEnd"><path d="M 18,7 L9,13 L1,7 L9,1 Z"/></marker></defs><defs><marker orient="auto" markerHeight="240" markerWidth="190" refY="7" refX="0" class="marker extension classDiagram" id="classDiagram-extensionStart"><path d="M 1,7 L18,13 V 1 Z"/></marker></defs><defs><marker orient="auto" markerHeight="28" markerWidth="20" refY="7" refX="19" class="marker extension classDiagram" id="classDiagram-extensionEnd"><path d="M 1,1 V 13 L18,7 Z"/></marker></defs><defs><marker orient="auto" markerHeight="240" markerWidth="190" refY="7" refX="0" class="marker composition classDiagram" id="classDiagram-compositionStart"><path d="M 18,7 L9,13 L1,7 L9,1 Z"/></marker></defs><defs><marker orient="auto" markerHeight="28" markerWidth="20" refY="7" refX="19" class="marker composition classDiagram" id="classDiagram-compositionEnd"><path d="M 18,7 L9,13 L1,7 L9,1 Z"/></marker></defs><defs><marker orient="auto" markerHeight="240" markerWidth="190" refY="7" refX="0" class="marker dependency classDiagram" id="classDiagram-dependencyStart"><path d="M 5,7 L9,13 L1,7 L9,1 Z"/></marker></defs><defs><marker orient="auto" markerHeight="28" markerWidth="20" refY="7" refX="19" class="marker dependency classDiagram" id="classDiagram-dependencyEnd"><path d="M 18,7 L9,13 L14,7 L9,1 Z"/></marker></defs><defs><marker orient="auto" markerHeight="240" markerWidth="190" refY="7" refX="0" class="marker lollipop classDiagram" id="classDiagram-lollipopStart"><circle r="6" cy="7" cx="6" fill="white" stroke="black"/></marker></defs><g class="root"><g class="clusters"/><g class="edgePaths"><path marker-end="url(#classDiagram-compositionEnd)" style="fill:none" class="edge-pattern-solid relation" id="id1" d="M770.7163284425812,171L762.7974612021511,177.91666666666666C754.8785939617209,184.83333333333334,739.0408594808605,198.66666666666666,731.1219922404302,214.5C723.203125,230.33333333333334,723.203125,248.16666666666666,723.203125,257.0833333333333L723.203125,266"/><path marker-start="url(#classDiagram-dependencyStart)" style="fill:none" class="edge-pattern-solid relation" id="id2" d="M670.197265625,124.06635318704284L587.5498046875,138.8052943225357C504.90234375,153.54423545802857,339.607421875,183.0221177290143,256.9599609375,204.6777255311738C174.3125,226.33333333333334,174.3125,240.16666666666666,174.3125,247.08333333333334L174.3125,254"/><path marker-end="url(#classDiagram-aggregationEnd)" style="fill:none" class="edge-pattern-solid relation" id="id3" d="M376.7265625,375L376.7265625,384.4166666666667C376.7265625,393.8333333333333,376.7265625,412.6666666666667,391.09819240196083,429.4166666666667C405.46982230392155,446.1666666666667,434.2130821078431,460.8333333333333,448.5847120098039,468.1666666666667L462.9563419117647,475.5"/><path marker-end="url(#classDiagram-aggregationEnd)" style="fill:none" class="edge-pattern-solid relation" id="id4" d="M703.2501481042653,386L700.7283135243879,393.5833333333333C698.2064789445103,401.1666666666667,693.1628097847552,416.3333333333333,680.5896578029168,431.25C668.0165058210783,446.1666666666667,647.9138710171568,460.8333333333333,637.862553615196,468.1666666666667L627.8112362132352,475.5"/><path marker-end="url(#classDiagram-aggregationEnd)" style="fill:none" class="edge-pattern-solid relation" id="id5" d="M935.2421875,374.51657531113125L976.7493489583334,384.01381275927605C1018.2565104166666,393.5110502074208,1101.2708333333333,412.5055251037104,1142.7779947916667,437.58609588518857C1184.28515625,462.6666666666667,1184.28515625,493.8333333333333,1184.28515625,525C1184.28515625,556.1666666666666,1184.28515625,587.3333333333334,1187.619387811943,608.5C1190.9536193738859,629.6666666666666,1197.6220824977718,640.8333333333334,1200.9563140597147,646.4166666666666L1204.2905456216577,652"/><path marker-end="url(#classDiagram-dependencyEnd)" style="fill:none" class="edge-pattern-solid relation" id="id6" d="M1062.0461900177725,365L1058.3604317856436,376.0833333333333C1054.674673553515,387.1666666666667,1047.3031570892574,409.3333333333333,987.6958493779621,431.310472051425C928.0885416666666,453.2876107695167,816.2454427083334,475.0752215390333,760.3238932291666,485.96902692379166L704.40234375,496.86283230854997"/><path marker-end="url(#classDiagram-dependencyEnd)" style="fill:none" class="edge-pattern-solid relation" id="id7" d="M1295.95703125,375.5L1295.95703125,384.8333333333333C1295.95703125,394.1666666666667,1295.95703125,412.8333333333333,1295.95703125,427.75C1295.95703125,442.6666666666667,1295.95703125,453.8333333333333,1295.95703125,459.4166666666667L1295.95703125,465"/><path marker-end="url(#classDiagram-dependencyEnd)" style="fill:none" class="edge-pattern-solid relation" id="id8" d="M1295.95703125,585L1295.95703125,590.5833333333334C1295.95703125,596.1666666666666,1295.95703125,607.3333333333334,1292.622799688057,618.5C1289.2885681261141,629.6666666666666,1282.6201050022282,640.8333333333334,1279.2858734402853,646.4166666666666L1275.9516418783423,652"/><path marker-end="url(#classDiagram-dependencyEnd)" style="fill:none" class="edge-pattern-solid relation" id="id9" d="M1057.853515625,144.69590864078066L1097.5374348958333,155.9965905339839C1137.2213541666667,167.2972724271871,1216.5891927083333,189.89863621359356,1256.2731119791667,211.86598477346342C1295.95703125,233.83333333333334,1295.95703125,255.16666666666666,1295.95703125,265.8333333333333L1295.95703125,276.5"/><path marker-end="url(#classDiagram-dependencyEnd)" style="fill:none" class="edge-pattern-solid relation" id="id10" d="M1003.8278629954268,171L1015.692489996189,177.91666666666666C1027.5571169969512,184.83333333333334,1051.2863709984756,198.66666666666666,1063.1509979992377,218C1075.015625,237.33333333333334,1075.015625,262.1666666666667,1075.015625,274.5833333333333L1075.015625,287"/></g><g class="edgeLabels"><g class="edgeLabel"><g transform="translate(0, 0)" class="label"><rect height="0" width="0" ry="0" rx="0"/><text style=""><tspan class="row" x="0" dy="1em" xml:space="preserve"/></text></g></g><g transform="translate(174.3125, 212.5)" class="edgeLabel"><g transform="translate(-166.3125, -16.5)" class="label"><rect height="33.89130401611328" width="333.3670654296875" ry="0" rx="0"/><text style=""><tspan class="row" x="0" dy="1em" xml:space="preserve">sends inbound msgs via channels,</tspan><tspan class="row" x="0" dy="1em" xml:space="preserve">receives channel Receivers for outbound msgs</tspan></text></g></g><g class="edgeLabel"><g transform="translate(0, 0)" class="label"><rect height="0" width="0" ry="0" rx="0"/><text style=""><tspan class="row" x="0" dy="1em" xml:space="preserve"/></text></g></g><g class="edgeLabel"><g transform="translate(0, 0)" class="label"><rect height="0" width="0" ry="0" rx="0"/><text style=""><tspan class="row" x="0" dy="1em" xml:space="preserve"/></text></g></g><g class="edgeLabel"><g transform="translate(0, 0)" class="label"><rect height="0" width="0" ry="0" rx="0"/><text style=""><tspan class="row" x="0" dy="1em" xml:space="preserve"/></text></g></g><g transform="translate(1039.931640625, 431.5)" class="edgeLabel"><g transform="translate(-70.3125, -8.5)" class="label"><rect height="17.89130210876465" width="140.49127197265625" ry="0" rx="0"/><text style=""><tspan class="row" x="0" dy="1em" xml:space="preserve">consumed to create</tspan></text></g></g><g transform="translate(1295.95703125, 431.5)" class="edgeLabel"><g transform="translate(-91.671875, -8.5)" class="label"><rect height="17.89130210876465" width="184.07550048828125" ry="0" rx="0"/><text style=""><tspan class="row" x="0" dy="1em" xml:space="preserve">when auth token received</tspan></text></g></g><g transform="translate(1295.95703125, 618.5)" class="edgeLabel"><g transform="translate(-70.3125, -8.5)" class="label"><rect height="17.89130210876465" width="140.49127197265625" ry="0" rx="0"/><text style=""><tspan class="row" x="0" dy="1em" xml:space="preserve">consumed to create</tspan></text></g></g><g transform="translate(1295.95703125, 212.5)" class="edgeLabel"><g transform="translate(-82.55078125, -8.5)" class="label"><rect height="17.89130210876465" width="165.37240600585938" ry="0" rx="0"/><text style=""><tspan class="row" x="0" dy="1em" xml:space="preserve">create upon websocket</tspan></text></g></g><g transform="translate(1075.015625, 212.5)" class="edgeLabel"><g transform="translate(-82.55078125, -8.5)" class="label"><rect height="17.89130210876465" width="165.37240600585938" ry="0" rx="0"/><text style=""><tspan class="row" x="0" dy="1em" xml:space="preserve">create upon websocket</tspan></text></g></g></g><g class="nodes"><g transform="translate(864.025390625, 89.5)" id="classId-Balancer-0" class="node default"><rect height="163" width="387.65625" y="-81.5" x="-193.828125" class="outer title-state"/><line y2="-31.5" y1="-31.5" x2="193.828125" x1="-193.828125" class="divider"/><line y2="26.5" y1="26.5" x2="193.828125" x1="-193.828125" class="divider"/><g class="label"><text transform="translate( -34.2890625, -74)" style=""><tspan class="title-row" x="0" dy="1em" xml:space="preserve">«service»</tspan></text><text transform="translate( -33.796875, -53)" class="classTitle" style=""><tspan class="title-row" x="0" dy="1em" xml:space="preserve">Balancer</tspan></text><text transform="translate( -186.328125, -20)" style=""><tspan class="title-row" x="0" dy="1em" xml:space="preserve">ctx: Arc&lt;RwLock&lt;BalancerContext&gt;&gt;</tspan></text><text transform="translate( -186.328125, 1)" style=""><tspan class="title-row" x="0" dy="1em" xml:space="preserve">...[channels for receiving new nodes, and messages]</tspan></text><text transform="translate( -186.328125, 34)" style=""><tspan class="title-row" x="0" dy="1em" xml:space="preserve">new_link() : BalancerLink</tspan></text><text transform="translate( -186.328125, 56)" style=""><tspan class="title-row" x="0" dy="1em" xml:space="preserve">dispatch_loop()</tspan></text></g></g><g transform="translate(174.3125, 326)" id="classId-BalancerLink-1" class="node default"><rect height="144" width="135.953125" y="-72" x="-67.9765625" class="outer title-state"/><line y2="-43" y1="-43" x2="67.9765625" x1="-67.9765625" class="divider"/><line y2="61" y1="61" x2="67.9765625" x1="-67.9765625" class="divider"/><g class="label"><text style=""><tspan class="title-row" x="0" dy="1em" xml:space="preserve"/></text><text transform="translate( -50.29296875, -64.5)" class="classTitle" style=""><tspan class="title-row" x="0" dy="1em" xml:space="preserve">BalancerLink</tspan></text><text transform="translate( -60.4765625, -31.5)" style=""><tspan class="title-row" x="0" dy="1em" xml:space="preserve">new_client_tx</tspan></text><text transform="translate( -60.4765625, -9.5)" style=""><tspan class="title-row" x="0" dy="1em" xml:space="preserve">client_msg_tx</tspan></text><text transform="translate( -60.4765625, 12.5)" style=""><tspan class="title-row" x="0" dy="1em" xml:space="preserve">new_monolith_tx</tspan></text><text transform="translate( -60.4765625, 34.5)" style=""><tspan class="title-row" x="0" dy="1em" xml:space="preserve">monolith_msg_tx</tspan></text></g></g><g transform="translate(723.203125, 326)" id="classId-BalancerContext-2" class="node default"><rect height="120" width="424.078125" y="-60" x="-212.0390625" class="outer title-state"/><line y2="-31" y1="-31" x2="212.0390625" x1="-212.0390625" class="divider"/><line y2="49" y1="49" x2="212.0390625" x1="-212.0390625" class="divider"/><g class="label"><text style=""><tspan class="title-row" x="0" dy="1em" xml:space="preserve"/></text><text transform="translate( -63.91015625, -52.5)" class="classTitle" style=""><tspan class="title-row" x="0" dy="1em" xml:space="preserve">BalancerContext</tspan></text><text transform="translate( -204.5390625, -19.5)" style=""><tspan class="title-row" x="0" dy="1em" xml:space="preserve">clients: HashMap&lt;ClientId-BalancerClient&gt;,</tspan></text><text transform="translate( -204.5390625, 1.5)" style=""><tspan class="title-row" x="0" dy="1em" xml:space="preserve">monoliths: HashMap&lt;MonolithId-BalancerMonolith&gt;,</tspan></text><text transform="translate( -204.5390625, 22.5)" style=""><tspan class="title-row" x="0" dy="1em" xml:space="preserve">rooms_to_monoliths: HashMap&lt;RoomName-MonolithId&gt;,</tspan></text></g></g><g transform="translate(1075.015625, 326)" id="classId-NewMonolith-3" class="node default"><rect height="78" width="179.546875" y="-39" x="-89.7734375" class="outer title-state"/><line y2="-10" y1="-10" x2="89.7734375" x1="-89.7734375" class="divider"/><line y2="28" y1="28" x2="89.7734375" x1="-89.7734375" class="divider"/><g class="label"><text style=""><tspan class="title-row" x="0" dy="1em" xml:space="preserve"/></text><text transform="translate( -49.7734375, -31.5)" class="classTitle" style=""><tspan class="title-row" x="0" dy="1em" xml:space="preserve">NewMonolith</tspan></text><text transform="translate( -82.2734375, 1.5)" style=""><tspan class="title-row" x="0" dy="1em" xml:space="preserve">monolith_id: MonolithId</tspan></text></g></g><g transform="translate(559.96484375, 525)" id="classId-BalancerMonolith-4" class="node default"><rect height="99" width="288.875" y="-49.5" x="-144.4375" class="outer title-state"/><line y2="-20.5" y1="-20.5" x2="144.4375" x1="-144.4375" class="divider"/><line y2="38.5" y1="38.5" x2="144.4375" x1="-144.4375" class="divider"/><g class="label"><text style=""><tspan class="title-row" x="0" dy="1em" xml:space="preserve"/></text><text transform="translate( -67.1171875, -42)" class="classTitle" style=""><tspan class="title-row" x="0" dy="1em" xml:space="preserve">BalancerMonolith</tspan></text><text transform="translate( -136.9375, -9)" style=""><tspan class="title-row" x="0" dy="1em" xml:space="preserve">monolith_id: MonolithId</tspan></text><text transform="translate( -136.9375, 13)" style=""><tspan class="title-row" x="0" dy="1em" xml:space="preserve">rooms: Hashmap&lt;RoomName-Room&gt;</tspan></text></g></g><g transform="translate(376.7265625, 326)" id="classId-Room-5" class="node default"><rect height="98" width="168.875" y="-49" x="-84.4375" class="outer title-state"/><line y2="-20" y1="-20" x2="84.4375" x1="-84.4375" class="divider"/><line y2="38" y1="38" x2="84.4375" x1="-84.4375" class="divider"/><g class="label"><text style=""><tspan class="title-row" x="0" dy="1em" xml:space="preserve"/></text><text transform="translate( -22.6640625, -41.5)" class="classTitle" style=""><tspan class="title-row" x="0" dy="1em" xml:space="preserve">Room</tspan></text><text transform="translate( -76.9375, -8.5)" style=""><tspan class="title-row" x="0" dy="1em" xml:space="preserve">name: RoomName</tspan></text><text transform="translate( -76.9375, 12.5)" style=""><tspan class="title-row" x="0" dy="1em" xml:space="preserve">clients: Vec&lt;ClientId&gt;</tspan></text></g></g><g transform="translate(1240.12109375, 712)" id="classId-BalancerClient-6" class="node default"><rect height="120" width="145.8046875" y="-60" x="-72.90234375" class="outer title-state"/><line y2="-31" y1="-31" x2="72.90234375" x1="-72.90234375" class="divider"/><line y2="49" y1="49" x2="72.90234375" x1="-72.90234375" class="divider"/><g class="label"><text style=""><tspan class="title-row" x="0" dy="1em" xml:space="preserve"/></text><text transform="translate( -56.35546875, -52.5)" class="classTitle" style=""><tspan class="title-row" x="0" dy="1em" xml:space="preserve">BalancerClient</tspan></text><text transform="translate( -65.40234375, -19.5)" style=""><tspan class="title-row" x="0" dy="1em" xml:space="preserve">client_id: ClientId</tspan></text><text transform="translate( -65.40234375, 2.5)" style=""><tspan class="title-row" x="0" dy="1em" xml:space="preserve">room: RoomName</tspan></text><text transform="translate( -65.40234375, 23.5)" style=""><tspan class="title-row" x="0" dy="1em" xml:space="preserve">token: String</tspan></text></g></g><g transform="translate(1295.95703125, 326)" id="classId-UnauthorizedClient-7" class="node default"><rect height="99" width="162.3359375" y="-49.5" x="-81.16796875" class="outer title-state"/><line y2="-20.5" y1="-20.5" x2="81.16796875" x1="-81.16796875" class="divider"/><line y2="38.5" y1="38.5" x2="81.16796875" x1="-81.16796875" class="divider"/><g class="label"><text style=""><tspan class="title-row" x="0" dy="1em" xml:space="preserve"/></text><text transform="translate( -73.66796875, -42)" class="classTitle" style=""><tspan class="title-row" x="0" dy="1em" xml:space="preserve">UnauthorizedClient</tspan></text><text transform="translate( -73.66796875, -9)" style=""><tspan class="title-row" x="0" dy="1em" xml:space="preserve">client_id: ClientId</tspan></text><text transform="translate( -73.66796875, 13)" style=""><tspan class="title-row" x="0" dy="1em" xml:space="preserve">room: RoomName</tspan></text></g></g><g transform="translate(1295.95703125, 525)" id="classId-NewClient-8" class="node default"><rect height="120" width="145.8046875" y="-60" x="-72.90234375" class="outer title-state"/><line y2="-31" y1="-31" x2="72.90234375" x1="-72.90234375" class="divider"/><line y2="49" y1="49" x2="72.90234375" x1="-72.90234375" class="divider"/><g class="label"><text style=""><tspan class="title-row" x="0" dy="1em" xml:space="preserve"/></text><text transform="translate( -39.0078125, -52.5)" class="classTitle" style=""><tspan class="title-row" x="0" dy="1em" xml:space="preserve">NewClient</tspan></text><text transform="translate( -65.40234375, -19.5)" style=""><tspan class="title-row" x="0" dy="1em" xml:space="preserve">client_id: ClientId</tspan></text><text transform="translate( -65.40234375, 2.5)" style=""><tspan class="title-row" x="0" dy="1em" xml:space="preserve">room: RoomName</tspan></text><text transform="translate( -65.40234375, 23.5)" style=""><tspan class="title-row" x="0" dy="1em" xml:space="preserve">token: String</tspan></text></g></g></g></g></g></svg>